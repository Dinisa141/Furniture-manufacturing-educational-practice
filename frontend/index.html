<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Мебельная фабрика | Управление производством</title>
    
    <!-- Vue.js через CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Font Awesome для иконок -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Стили -->
    <link rel="stylesheet" href="style.css">
    
    <style>
        /* Дополнительные inline стили для быстрой настройки */
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Хедер с логотипом -->
        <header class="app-header">
            <div class="logo">
                <div class="logo-icon">
                    <img src="img/logo.ico" alt="logo" class="logo-icon">
                </div>
                <div class="logo-text">
                    <h1>Мебельная фабрика "Древо"</h1>
                    <p>Система управления производством</p>
                </div>
            </div>
            <div class="header-status">
                <span :class="{'status-online': apiConnected, 'status-offline': !apiConnected}">
                    <i class="fas" :class="apiConnected ? 'fa-plug' : 'fa-plug-circle-exclamation'"></i>
                    {{ apiConnected ? 'API подключен' : 'API отключен' }}
                </span>
                <span class="user-info">
                    <i class="fas fa-user-circle"></i> Администратор
                </span>
            </div>
        </header>

        <!-- Основной контейнер -->
        <div class="app-container">
            <!-- Sidebar меню -->
            <aside class="sidebar">
                <nav class="sidebar-nav">
                    <button v-for="item in menuItems" 
                            :key="item.id"
                            @click="changePage(item.id)"
                            :class="{'active': currentPage === item.id}"
                            class="nav-item">
                        <i :class="item.icon"></i>
                        <span>{{ item.name }}</span>
                        <span v-if="item.badge" class="badge">{{ item.badge }}</span>
                    </button>
                </nav>
                
                <div class="sidebar-footer">
                    <p>Версия 1.0.0</p>
                    <p>{{ currentTime }}</p>
                </div>
            </aside>

            <!-- Основное содержимое -->
            <main class="main-content">
                <!-- Хлебные крошки -->
                <nav class="breadcrumbs">
                    <button @click="goBack" class="btn-back" :disabled="history.length <= 1">
                        <i class="fas fa-arrow-left"></i> Назад
                    </button>
                    <div class="breadcrumb-path">
                        <span class="breadcrumb-item active">{{ pageTitle }}</span>
                    </div>
                </nav>

                <!-- Динамический контент -->
                <div class="content-area">
                    <!-- Страница загрузки -->
                    <div v-if="loading" class="loading-container">
                        <div class="spinner"></div>
                        <p>Загрузка данных...</p>
                    </div>

                    <!-- Главная страница -->
                    <div v-else-if="currentPage === 'dashboard'" class="page-dashboard">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon" style="background: #3498db;">
                                    <i class="fas fa-box"></i>
                                </div>
                                <div class="stat-info">
                                    <h3>{{ products.length }}</h3>
                                    <p>Продуктов</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon" style="background: #e74c3c;">
                                    <i class="fas fa-warehouse"></i>
                                </div>
                                <div class="stat-info">
                                    <h3>{{ workshops.length }}</h3>
                                    <p>Цехов</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon" style="background: #27ae60;">
                                    <i class="fas fa-cubes"></i>
                                </div>
                                <div class="stat-info">
                                    <h3>{{ materials.length }}</h3>
                                    <p>Материалов</p>
                                </div>
                            </div>
                        </div>

                        <div class="recent-products">
                            <h3><i class="fas fa-history"></i> Последние продукты</h3>
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Артикул</th>
                                        <th>Наименование</th>
                                        <th>Стоимость</th>
                                        <th>Действия</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="product in recentProducts" :key="product.id">
                                        <td><strong>{{ product.article }}</strong></td>
                                        <td>{{ product.product_name }}</td>
                                        <td>{{ formatCurrency(product.minimum_cost) }}</td>
                                        <td>
                                            <button @click="editProduct(product)" class="btn-small btn-warning">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Страница продукции -->
                    <div v-else-if="currentPage === 'products'" class="page-products">
                        <div class="page-header">
                            <h2><i class="fas fa-box"></i> Управление продукцией</h2>
                            <button @click="showProductModal = true; editingProduct = null" class="btn btn-success">
                                <i class="fas fa-plus"></i> Добавить продукт
                            </button>
                        </div>

                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Артикул</th>
                                        <th>Наименование</th>
                                        <th>Минимальная стоимость</th>
                                        <th>Основной материал</th>
                                        <th>Тип продукции</th>
                                        <th>Действия</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="product in products" :key="product.id">
                                        <td>{{ product.id }}</td>
                                        <td><strong>{{ product.article }}</strong></td>
                                        <td>{{ product.product_name }}</td>
                                        <td>{{ formatCurrency(product.minimum_cost) }}</td>
                                        <td>{{ getMaterialName(product.main_material_id) }}</td>
                                        <td>{{ getProductTypeName(product.product_type_id) }}</td>
                                        <td class="actions">
                                            <button @click="editProduct(product)" class="btn-small btn-warning">
                                                <i class="fas fa-edit"></i> Изменить
                                            </button>
                                            <button @click="deleteProduct(product.id)" class="btn-small btn-danger">
                                                <i class="fas fa-trash"></i> Удалить
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <div v-if="products.length === 0" class="empty-state">
                                <i class="fas fa-inbox"></i>
                                <p>Нет данных о продукции</p>
                                <button @click="showProductModal = true" class="btn btn-success">
                                    Добавить первый продукт
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Страница цехов -->
                    <div v-else-if="currentPage === 'workshops'" class="page-workshops">
                        <div class="page-header">
                            <h2><i class="fas fa-warehouse"></i> Управление цехами</h2>
                            <button @click="showWorkshopModal = true" class="btn btn-success">
                                <i class="fas fa-plus"></i> Добавить цех
                            </button>
                        </div>

                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Название цеха</th>
                                        <th>Тип цеха</th>
                                        <th>Количество сотрудников</th>
                                        <th>Действия</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="workshop in workshops" :key="workshop.id">
                                        <td>{{ workshop.id }}</td>
                                        <td><strong>{{ workshop.workshop_name }}</strong></td>
                                        <td>{{ workshop.workshop_type }}</td>
                                        <td>{{ workshop.number_of_people }}</td>
                                        <td class="actions">
                                            <button @click="editWorkshop(workshop)" class="btn-small btn-warning">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button @click="deleteWorkshop(workshop.id)" class="btn-small btn-danger">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Другие страницы -->
                    <div v-else-if="currentPage === 'materials'" class="page-materials">
                        <h2><i class="fas fa-cubes"></i> Материалы</h2>
                        <p>Страница материалов в разработке...</p>
                    </div>

                    <div v-else-if="currentPage === 'types'" class="page-types">
                        <h2><i class="fas fa-tags"></i> Типы продукции</h2>
                        <p>Страница типов продукции в разработке...</p>
                    </div>

                    <div v-else-if="currentPage === 'connections'" class="page-connections">
                        <h2><i class="fas fa-link"></i> Связи продукции и цехов</h2>
                        <div class="card">
                            <h3><i class="fas fa-calculator"></i> Расчет времени изготовления</h3>
                            <p>Время изготовления продукции складывается из времени нахождения в каждом цехе.</p>
                            
                            <div class="form-group">
                                <label>Выберите продукт:</label>
                                <select v-model="selectedProduct" @change="calculateProductionTime" class="form-input">
                                    <option value="">-- Выберите продукт --</option>
                                    <option v-for="product in products" :key="product.id" :value="product.id">
                                        {{ product.product_name }} ({{ product.article }})
                                    </option>
                                </select>
                            </div>

                            <div v-if="productionTime" class="result-card">
                                <h4>Результат расчета:</h4>
                                <p><strong>Общее время производства:</strong> {{ productionTime }} часов</p>
                                <small>Время складывается из времени в каждом цехе, где производится данный продукт</small>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Футер -->
        <footer class="app-footer">
            <p>© 2006–{{ currentYear }} Мебельная фабрика "Древо". Все права защищены.</p>
            <p>Время загрузки: {{ loadTime }}с | Элементов: {{ totalItems }}</p>
        </footer>

        <!-- Модальное окно для продукта -->
        <div v-if="showProductModal" class="modal-overlay" @click.self="showProductModal = false">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>{{ editingProduct ? 'Редактирование продукта' : 'Добавление нового продукта' }}</h3>
                    <button @click="showProductModal = false" class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <form @submit.prevent="saveProduct">
                        <div class="form-group">
                            <label for="article">Артикул *</label>
                            <input type="text" id="article" v-model="productForm.article" 
                                   class="form-input" placeholder="Например: ST-001" required>
                            <div v-if="errors.article" class="error-message">{{ errors.article }}</div>
                        </div>

                        <div class="form-group">
                            <label for="product_name">Наименование *</label>
                            <input type="text" id="product_name" v-model="productForm.product_name" 
                                   class="form-input" placeholder="Например: Стул офисный" required>
                            <div v-if="errors.product_name" class="error-message">{{ errors.product_name }}</div>
                        </div>

                        <div class="form-group">
                            <label for="minimum_cost">Минимальная стоимость *</label>
                            <input type="number" id="minimum_cost" v-model="productForm.minimum_cost" 
                                   step="0.01" min="0" class="form-input" placeholder="0.00" required>
                            <div v-if="errors.minimum_cost" class="error-message">{{ errors.minimum_cost }}</div>
                            <small>Стоимость в рублях, с точностью до копеек (сотых). Не может быть отрицательной.</small>
                        </div>

                        <div class="form-group">
                            <label for="main_material_id">Основной материал *</label>
                            <select id="main_material_id" v-model="productForm.main_material_id" class="form-input" required>
                                <option value="">-- Выберите материал --</option>
                                <option v-for="material in materials" :key="material.id" :value="material.id">
                                    {{ material.material_name }}
                                </option>
                            </select>
                            <div v-if="errors.main_material_id" class="error-message">{{ errors.main_material_id }}</div>
                        </div>

                        <div class="form-group">
                            <label for="product_type_id">Тип продукции *</label>
                            <select id="product_type_id" v-model="productForm.product_type_id" class="form-input" required>
                                <option value="">-- Выберите тип --</option>
                                <option v-for="type in productTypes" :key="type.id" :value="type.id">
                                    {{ type.type_name }}
                                </option>
                            </select>
                            <div v-if="errors.product_type_id" class="error-message">{{ errors.product_type_id }}</div>
                        </div>

                        <div class="form-actions">
                            <button type="button" @click="showProductModal = false" class="btn btn-secondary">
                                Отмена
                            </button>
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-save"></i> 
                                {{ editingProduct ? 'Сохранить изменения' : 'Добавить продукт' }}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Уведомления -->
        <div class="notifications-container">
            <div v-for="notification in notifications" 
                 :key="notification.id"
                 :class="['notification', notification.type]"
                 @click="removeNotification(notification.id)">
                <i :class="notification.icon"></i>
                <div>
                    <strong>{{ notification.title }}</strong>
                    <p>{{ notification.message }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Подключаем основной JS файл -->
    <script src="app.js"></script>
</body>
</html>